# Regras de CÃ¡lculo do Fator de ComissÃ£o

## REGRA FUNDAMENTAL - NUNCA VIOLAR

O cÃ¡lculo de comissÃ£o **NÃƒO** Ã© aplicado diretamente sobre a parcela.
Ã‰ necessÃ¡rio calcular o **FATOR** usando o pro-soluto como divisor.

---

## ðŸ“Š FÃ“RMULAS OBRIGATÃ“RIAS

### 1. FATOR DE COMISSÃƒO TOTAL

```javascript
// CORRETO âœ…
const fatorComissaoTotal = (valorTotalVenda * percentualTotalComissao) / valorProSolutoTotal

// Exemplo:
// fatorComissaoTotal = (292.366,06 Ã— 0,07) / 69.804,18 = 0,2932 = 29,32%
```

### 2. FATOR POR CARGO

```javascript
// CORRETO âœ…
const fatorCargo = (valorTotalVenda * percentualCargo) / valorProSolutoTotal

// Exemplo (Corretor 4%):
// fatorCorretor = (292.366,06 Ã— 0,04) / 69.804,18 = 0,1675 = 16,75%
```

### 3. COMISSÃƒO POR PARCELA

```javascript
// CORRETO âœ…
const comissaoParcela = valorParcela * fatorCargo

// Exemplo:
// comissaoCorretor = 1.292,67 Ã— 0,1675 = R$ 216,52
```

---

## âŒ O QUE NUNCA FAZER

```javascript
// ERRADO âŒ - NÃ£o aplique percentual diretamente na parcela!
const comissaoErrada = valorParcela * (percentualCargo / 100)
// 1.292,67 Ã— 0,04 = R$ 51,71 â† ERRADO!
```

---

## ðŸ“‹ LÃ“GICA EXPLICADA

| VariÃ¡vel | FÃ³rmula |
|----------|---------|
| `fatorTotal` | `(valorVenda Ã— percentualTotal) / proSoluto` |
| `fatorCargo` | `(valorVenda Ã— percentualCargo) / proSoluto` |
| `comissaoParcela` | `valorParcela Ã— fatorCargo` |

---

## ðŸŽ¯ POR QUE ISSO FUNCIONA

A comissÃ£o Ã© calculada sobre o **VALOR TOTAL DA VENDA**, mas o pagamento Ã© feito sobre o **PRO-SOLUTO**.

O **FATOR** faz a conversÃ£o entre esses dois mundos:
- Para cada R$ 1,00 de pro-soluto pago, qual Ã© a comissÃ£o correspondente?

---

## ðŸ“ EXEMPLO COMPLETO (FIGUEIRA GARCIA)

**Dados da Venda:**
- Valor Total: R$ 292.366,06
- Pro-Soluto: R$ 69.804,18 (54 parcelas de R$ 1.292,67)
- ComissÃ£o Total: 7% (soma dos cargos)

**Cargos e seus fatores:**
| Cargo | % | Fator | ComissÃ£o/Parcela | Total 54 Parcelas |
|-------|---|-------|------------------|-------------------|
| Corretor | 4,00% | 0,1675 | R$ 216,52 | R$ 11.692,08 |
| Diretor | 0,50% | 0,0209 | R$ 27,02 | R$ 1.459,08 |
| Nohros | 0,50% | 0,0209 | R$ 27,02 | R$ 1.459,08 |
| Ferretti | 1,00% | 0,0419 | R$ 54,16 | R$ 2.924,64 |
| Beton | 0,50% | 0,0209 | R$ 27,02 | R$ 1.459,08 |
| Coordenadora | 0,50% | 0,0209 | R$ 27,02 | R$ 1.459,08 |
| **TOTAL** | **7,00%** | **0,2932** | **R$ 379,03** | **R$ 20.467,62** |

---

## ðŸ”§ ONDE APLICAR NO CÃ“DIGO

1. **`syncVendasV2.js`** - Ao criar pagamentos pro-soluto
2. **`AdminDashboard.jsx`** - Ao calcular comissÃµes dinÃ¢micas
3. **`ImportarVendas.jsx`** - Ao importar vendas manualmente
4. **`CorretorDashboard.jsx`** - Ao exibir comissÃµes do corretor

---

## âš ï¸ VALIDAÃ‡ÃƒO

Sempre validar que:
```javascript
// A soma das comissÃµes por cargo deve ser igual Ã  comissÃ£o total
const somaComissoesCargos = cargos.reduce((acc, c) => acc + comissaoPorCargo[c], 0)
const comissaoTotal = valorParcela * fatorTotal
// somaComissoesCargos === comissaoTotal (com tolerÃ¢ncia de centavos)
```

---

## ðŸ“ RESUMO

```
FATOR = (VALOR_VENDA Ã— PERCENTUAL) / PRO_SOLUTO
COMISSÃƒO = PARCELA Ã— FATOR
```

**Esta Ã© a Ãºnica fÃ³rmula correta. Qualquer outra estÃ¡ ERRADA.**

---

## ðŸ”„ VERSIONAMENTO DE PERCENTUAIS

### AlteraÃ§Ã£o de Percentuais

Quando um percentual Ã© alterado:

1. **Vendas antigas** â†’ Usam o percentual **do momento da criaÃ§Ã£o** (snapshot em `comissoes_venda`)
2. **Vendas novas** â†’ Usam o percentual **atual** de `cargos_empreendimento`
3. **HistÃ³rico** â†’ Registrado automaticamente em `cargos_empreendimento_historico`

### Tabelas Envolvidas

| Tabela | PropÃ³sito |
|--------|-----------|
| `cargos_empreendimento` | Percentuais ATUAIS |
| `cargos_empreendimento_historico` | Log de alteraÃ§Ãµes |
| `comissoes_venda` | Snapshot por venda (imutÃ¡vel) |
| `pagamentos_prosoluto.fator_comissao_aplicado` | Fator usado no pagamento |

### Regra de Ouro

> **NUNCA recalcule comissÃµes de vendas antigas ao alterar percentuais.**
> 
> Use sempre o `fator_comissao_aplicado` salvo em `pagamentos_prosoluto`.
